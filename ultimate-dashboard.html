<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHAM v5 Ultimate - Complete Archaeological Intelligence Platform</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --bg2: #12121a;
            --bg3: #1a1a24;
            --gold: #d4a574;
            --blue: #3b82f6;
            --green: #10b981;
            --red: #ef4444;
            --purple: #8b5cf6;
            --cyan: #06b6d4;
            --text: #fff;
            --muted: #71717a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 280px;
            background: var(--bg2);
            border-right: 1px solid #27272a;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .logo {
            padding: 1.5rem;
            border-bottom: 1px solid #27272a;
        }

        .logo-main {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--gold), #f59e0b);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .logo h1 {
            font-size: 1.25rem;
            background: linear-gradient(135deg, var(--gold), #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo span {
            font-size: 0.65rem;
            color: var(--muted);
            display: block;
            margin-top: 2px;
        }

        .nav {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0;
        }

        .nav-section {
            padding: 0 1rem;
            margin-bottom: 1rem;
        }

        .nav-section-title {
            font-size: 0.65rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            text-decoration: none;
            margin-bottom: 2px;
        }

        .nav-item:hover {
            background: var(--bg3);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.2), rgba(245, 158, 11, 0.1));
            color: var(--gold);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .nav-badge {
            margin-left: auto;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--gold);
            color: var(--bg);
        }

        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid #27272a;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .quick-stat {
            background: var(--bg);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
        }

        .quick-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gold);
        }

        .quick-stat-label {
            font-size: 0.6rem;
            color: var(--muted);
            text-transform: uppercase;
        }

        /* Main Content */
        .main {
            margin-left: 280px;
            min-height: 100vh;
        }

        .header {
            background: var(--bg2);
            padding: 1rem 2rem;
            border-bottom: 1px solid #27272a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        .content {
            padding: 1.5rem 2rem;
        }

        .panel {
            display: none;
        }

        .panel.active {
            display: block;
        }

        /* Components */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold), #f59e0b);
            color: var(--bg);
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 165, 116, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #27272a;
            color: var(--text);
        }

        .btn-outline:hover {
            border-color: var(--gold);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .card {
            background: var(--bg3);
            border: 1px solid #27272a;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
        }

        .card-title i {
            color: var(--gold);
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--bg3), var(--bg2));
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #27272a;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--gold), #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            margin-top: 0.25rem;
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        .stat-change.up {
            color: var(--green);
        }

        .stat-change.down {
            color: var(--red);
        }

        #map {
            height: 400px;
            border-radius: 12px;
        }

        .log {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            background: var(--bg);
            padding: 1rem;
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 0.25rem 0;
            border-bottom: 1px solid #1a1a24;
            display: flex;
            gap: 0.5rem;
        }

        .log-time {
            color: var(--muted);
        }

        .log-type {
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 0.6rem;
        }

        .log-type.success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--green);
        }

        .log-type.info {
            background: rgba(59, 130, 246, 0.2);
            color: var(--blue);
        }

        .log-type.warn {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .log-type.error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--red);
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .module-card {
            background: var(--bg2);
            border: 1px solid #27272a;
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .module-card:hover {
            border-color: var(--gold);
            transform: translateY(-2px);
        }

        .module-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .module-card h4 {
            margin-bottom: 0.5rem;
        }

        .module-card p {
            font-size: 0.8rem;
            color: var(--muted);
        }

        .module-status {
            display: inline-block;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 0.75rem;
        }

        .module-status.active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--green);
        }

        .module-status.ready {
            background: rgba(59, 130, 246, 0.2);
            color: var(--blue);
        }

        .alert-banner {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(245, 158, 11, 0.1));
            border: 1px solid var(--red);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .alert-banner i {
            font-size: 1.5rem;
            color: var(--red);
        }

        .alert-banner h4 {
            color: var(--red);
        }

        @media (max-width:1200px) {

            .grid-3,
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width:900px) {
            .sidebar {
                width: 70px;
            }

            .sidebar .nav-item span,
            .sidebar .logo h1,
            .sidebar .logo span,
            .sidebar .nav-section-title,
            .sidebar-footer {
                display: none;
            }

            .main {
                margin-left: 70px;
            }

            .grid-3,
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-main">
                <div class="logo-icon"><i class="fas fa-satellite"></i></div>
                <div>
                    <h1>SHAM v5</h1><span>Ultimate Edition</span>
                </div>
            </div>
        </div>

        <nav class="nav">
            <div class="nav-section">
                <div class="nav-section-title">Core</div>
                <a class="nav-item active" data-panel="dashboard"><i
                        class="fas fa-chart-line"></i><span>Dashboard</span></a>
                <a class="nav-item" data-panel="fusion"><i class="fas fa-atom"></i><span>Sensor Fusion</span></a>
                <a class="nav-item" data-panel="ai"><i class="fas fa-brain"></i><span>AI Engine</span></a>
                <a class="nav-item" data-panel="map"><i class="fas fa-globe"></i><span>Global Sites</span></a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Data</div>
                <a class="nav-item" data-panel="scraper"><i class="fas fa-download"></i><span>Data Scraper</span></a>
                <a class="nav-item" data-panel="alerts"><i class="fas fa-bell"></i><span>Satellite Alerts</span><span
                        class="nav-badge">2</span></a>
                <a class="nav-item" data-panel="historical"><i class="fas fa-history"></i><span>Time Machine</span></a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Field Ops</div>
                <a class="nav-item" data-panel="mobile"><i class="fas fa-mobile-alt"></i><span>Mobile App</span></a>
                <a class="nav-item" data-panel="ar"><i class="fas fa-vr-cardboard"></i><span>AR Overlay</span></a>
                <a class="nav-item" data-panel="drone"><i class="fas fa-helicopter"></i><span>Drone Survey</span></a>
                <a class="nav-item" data-panel="gpr"><i class="fas fa-wave-square"></i><span>GPR Processing</span></a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Verification</div>
                <a class="nav-item" data-panel="blockchain"><i class="fas fa-link"></i><span>Blockchain Proof</span></a>
                <a class="nav-item" data-panel="ipfs"><i class="fas fa-cube"></i><span>IPFS Archive</span></a>
                <a class="nav-item" data-panel="crowd"><i class="fas fa-users"></i><span>Crowd Verify</span></a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Publish</div>
                <a class="nav-item" data-panel="papers"><i class="fas fa-file-alt"></i><span>Paper Generator</span></a>
                <a class="nav-item" data-panel="media"><i class="fas fa-newspaper"></i><span>Media Kit</span></a>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="quick-stats">
                <div class="quick-stat">
                    <div class="quick-stat-value" id="qs-sites">0</div>
                    <div class="quick-stat-label">Sites</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value" id="qs-anomalies">0</div>
                    <div class="quick-stat-label">Anomalies</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
        <header class="header">
            <div class="header-title" id="panel-title">Dashboard</div>
            <div class="header-actions">
                <button class="btn btn-outline btn-sm" onclick="exportAll()"><i class="fas fa-download"></i>
                    Export</button>
                <button class="btn btn-gold btn-sm" onclick="runFullAnalysis()"><i class="fas fa-play"></i> Run
                    Analysis</button>
            </div>
        </header>

        <div class="content">
            <!-- Dashboard Panel -->
            <div id="dashboard" class="panel active">
                <div class="grid-4" style="margin-bottom:1.5rem;">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-sites">48</div>
                        <div class="stat-label">Archaeological Sites</div>
                        <div class="stat-change up">↑ 12 new this week</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-anomalies">7</div>
                        <div class="stat-label">Detected Anomalies</div>
                        <div class="stat-change up">↑ 3 high-confidence</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-proofs">0</div>
                        <div class="stat-label">Proof Records</div>
                        <div class="stat-change">Blockchain verified</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-fusion">0%</div>
                        <div class="stat-label">Fusion Quality</div>
                        <div class="stat-change">5 sensors active</div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-map"></i>Live Archaeological Map</div>
                        </div>
                        <div id="map"></div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-terminal"></i>System Activity</div>
                        </div>
                        <div class="log" id="activity-log"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-th"></i>Active Modules</div>
                    </div>
                    <div class="module-grid" id="module-status"></div>
                </div>
            </div>

            <!-- Other panels will be populated dynamically -->
            <div id="fusion" class="panel">
                <div class="card">
                    <h3>Sensor Fusion Engine</h3>
                    <p>Multi-modal Bayesian fusion across SAR, Thermal, Seismic, Gravity, and Magnetic sensors.</p>
                    <button class="btn btn-gold" style="margin-top:1rem;" onclick="runFusion()"><i
                            class="fas fa-atom"></i> Run Fusion Analysis</button>
                    <div id="fusion-results" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="ai" class="panel">
                <div class="card">
                    <h3>AI Prediction Engine</h3>
                    <p>Machine learning model trained on 50+ verified archaeological sites.</p>
                    <div style="display:flex;gap:0.5rem;margin:1rem 0;"><input type="number" id="ai-lat" value="29.9792"
                            style="padding:0.5rem;background:var(--bg);border:1px solid #27272a;border-radius:6px;color:var(--text);"><input
                            type="number" id="ai-lon" value="31.1342"
                            style="padding:0.5rem;background:var(--bg);border:1px solid #27272a;border-radius:6px;color:var(--text);">
                    </div><button class="btn btn-gold" onclick="runAI()"><i class="fas fa-brain"></i> Predict</button>
                    <div id="ai-results" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="map" class="panel">
                <div class="card">
                    <h3>Global Sites Database</h3>
                    <div id="sites-list" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="scraper" class="panel">
                <div class="card">
                    <h3>Data Scraper</h3>
                    <p>Connect to Copernicus, USGS, NASA, IRIS for real satellite and geophysical data.</p>
                    <div style="display:flex;gap:0.5rem;margin-top:1rem;flex-wrap:wrap;"><button class="btn btn-outline"
                            onclick="window.open('https://browser.dataspace.copernicus.eu/')"><i
                                class="fas fa-satellite"></i> Copernicus</button><button class="btn btn-outline"
                            onclick="window.open('https://earthexplorer.usgs.gov/')"><i class="fas fa-sun"></i>
                            USGS</button><button class="btn btn-outline"
                            onclick="window.open('https://search.asf.alaska.edu/')"><i class="fas fa-mountain"></i>
                            ASF</button></div>
                </div>
            </div>
            <div id="alerts" class="panel">
                <div class="card">
                    <h3>Satellite Alerts</h3>
                    <p>Real-time monitoring for new imagery over watched areas.</p>
                    <div id="alerts-list" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="historical" class="panel">
                <div class="card">
                    <h3>Historical Time Machine</h3>
                    <p>Access CORONA spy satellite imagery (1960s) and historical archives.</p><button
                        class="btn btn-gold" style="margin-top:1rem;"
                        onclick="window.open('https://earthexplorer.usgs.gov/')"><i class="fas fa-history"></i> Open
                        CORONA Archive</button>
                </div>
            </div>
            <div id="mobile" class="panel">
                <div class="card">
                    <h3>Mobile Field App</h3>
                    <p>GPS-guided ground-truth investigation with proximity alerts.</p><button class="btn btn-gold"
                        style="margin-top:1rem;" onclick="startGPS()"><i class="fas fa-location-arrow"></i> Start GPS
                        Tracking</button>
                    <div id="gps-status" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="ar" class="panel">
                <div class="card">
                    <h3>AR Overlay System</h3>
                    <p>Augmented reality visualization of subsurface anomalies.</p>
                    <p style="color:var(--muted);margin-top:1rem;">Requires WebXR-capable device (iOS 15+, Android with
                        ARCore)</p>
                </div>
            </div>
            <div id="drone" class="panel">
                <div class="card">
                    <h3>Drone Survey Integration</h3>
                    <p>Generate flight plans and process UAV LiDAR/thermal data.</p><button class="btn btn-gold"
                        style="margin-top:1rem;" onclick="generateFlightPlan()"><i class="fas fa-route"></i> Generate
                        Flight Plan</button>
                    <div id="flight-plan" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="gpr" class="panel">
                <div class="card">
                    <h3>GPR Data Processing</h3>
                    <p>Ground Penetrating Radar signal processing and interpretation.</p><button class="btn btn-gold"
                        style="margin-top:1rem;" onclick="processGPR()"><i class="fas fa-wave-square"></i> Process GPR
                        Data</button>
                    <div id="gpr-results" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="blockchain" class="panel">
                <div class="card" style="border:2px solid var(--gold);">
                    <h3>Blockchain Proof System</h3>
                    <p>Create immutable, timestamped proof records for discoveries.</p><button class="btn btn-gold"
                        style="margin-top:1rem;" onclick="createProof()"><i class="fas fa-stamp"></i> Create Proof
                        Record</button>
                    <div id="proof-chain" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="ipfs" class="panel">
                <div class="card">
                    <h3>IPFS Decentralized Archive</h3>
                    <p>Censorship-resistant data storage on the InterPlanetary File System.</p><button
                        class="btn btn-gold" style="margin-top:1rem;" onclick="archiveToIPFS()"><i
                            class="fas fa-cube"></i> Archive to IPFS</button>
                    <div id="ipfs-archives" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="crowd" class="panel">
                <div class="card">
                    <h3>Crowdsourced Verification</h3>
                    <p>Submit discoveries for peer review and community voting.</p><button class="btn btn-gold"
                        style="margin-top:1rem;" onclick="submitForReview()"><i class="fas fa-users"></i> Submit for
                        Review</button>
                    <div id="review-status" style="margin-top:1rem;"></div>
                </div>
            </div>
            <div id="papers" class="panel">
                <div class="card">
                    <h3>Auto Paper Generator</h3>
                    <p>Generate publication-ready academic manuscripts.</p><button class="btn btn-gold"
                        style="margin-top:1rem;" onclick="generatePaper()"><i class="fas fa-file-alt"></i> Generate
                        Paper</button>
                    <div id="paper-preview" style="margin-top:1rem;max-height:400px;overflow-y:auto;font-size:0.85rem;">
                    </div>
                </div>
            </div>
            <div id="media" class="panel">
                <div class="card">
                    <h3>Media Kit Creator</h3>
                    <p>Press releases, social media content, and viral campaign materials.</p><button
                        class="btn btn-gold" style="margin-top:1rem;" onclick="createMediaKit()"><i
                            class="fas fa-newspaper"></i> Create Media Kit</button>
                    <div id="media-kit" style="margin-top:1rem;"></div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/sensor-fusion-engine.js"></script>
    <script src="js/data-scraper.js"></script>
    <script src="js/archaeological-ai.js"></script>
    <script src="js/global-sites-db.js"></script>
    <script src="js/blockchain-proof.js"></script>
    <script src="js/ipfs-archive.js"></script>
    <script src="js/crowdsourced-verification.js"></script>
    <script src="js/satellite-alerts.js"></script>
    <script src="js/historical-time-machine.js"></script>
    <script src="js/mobile-field-app.js"></script>
    <script src="js/ar-overlay.js"></script>
    <script src="js/drone-survey.js"></script>
    <script src="js/gpr-processor.js"></script>
    <script src="js/auto-paper-generator.js"></script>
    <script src="js/media-kit-creator.js"></script>
    <script>
        let map;

        document.addEventListener('DOMContentLoaded', () => {
            initNav();
            initMap();
            initModules();
            updateStats();
            log('SHAM v5 Ultimate initialized', 'success');
            log('All 16 modules loaded and ready', 'info');
        });

        function initNav() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                    item.classList.add('active');
                    const panelId = item.dataset.panel;
                    document.getElementById(panelId)?.classList.add('active');
                    document.getElementById('panel-title').textContent = item.querySelector('span')?.textContent || 'Dashboard';
                });
            });
        }

        function initMap() {
            map = L.map('map').setView([26.8, 30.8], 5);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);
            if (window.GLOBAL_SITES_DATABASE) {
                GLOBAL_SITES_DATABASE.getAllSites().forEach(site => {
                    L.circleMarker([site.lat, site.lon], { radius: 6, fillColor: '#d4a574', color: '#fff', weight: 1, fillOpacity: 0.8 })
                        .addTo(map).bindPopup(`<b>${site.name}</b><br>${site.type}`);
                });
            }
        }

        function initModules() {
            const modules = [
                { name: 'Sensor Fusion', icon: 'atom', color: '--blue', status: 'active' },
                { name: 'AI Engine', icon: 'brain', color: '--purple', status: 'active' },
                { name: 'Global Sites', icon: 'globe', color: '--green', status: 'active' },
                { name: 'Data Scraper', icon: 'download', color: '--cyan', status: 'ready' },
                { name: 'Satellite Alerts', icon: 'bell', color: '--gold', status: 'active' },
                { name: 'Time Machine', icon: 'history', color: '--purple', status: 'ready' },
                { name: 'Mobile Field', icon: 'mobile-alt', color: '--green', status: 'ready' },
                { name: 'AR Overlay', icon: 'vr-cardboard', color: '--cyan', status: 'ready' },
                { name: 'Drone Survey', icon: 'helicopter', color: '--blue', status: 'ready' },
                { name: 'GPR Processor', icon: 'wave-square', color: '--purple', status: 'ready' },
                { name: 'Blockchain', icon: 'link', color: '--gold', status: 'active' },
                { name: 'IPFS Archive', icon: 'cube', color: '--cyan', status: 'ready' },
                { name: 'Crowd Verify', icon: 'users', color: '--green', status: 'ready' },
                { name: 'Paper Gen', icon: 'file-alt', color: '--blue', status: 'ready' },
                { name: 'Media Kit', icon: 'newspaper', color: '--purple', status: 'ready' }
            ];

            document.getElementById('module-status').innerHTML = modules.map(m => `
                <div class="module-card">
                    <div class="module-icon" style="background:rgba(var(${m.color}),0.2);color:var(${m.color});"><i class="fas fa-${m.icon}"></i></div>
                    <h4>${m.name}</h4>
                    <p>Module loaded and functional</p>
                    <span class="module-status ${m.status}">${m.status.toUpperCase()}</span>
                </div>
            `).join('');
        }

        function updateStats() {
            if (window.GLOBAL_SITES_DATABASE) {
                const stats = GLOBAL_SITES_DATABASE.getStats();
                document.getElementById('stat-sites').textContent = stats.totalSites;
                document.getElementById('qs-sites').textContent = stats.totalSites;
            }
        }

        function log(msg, type = 'info') {
            const logEl = document.getElementById('activity-log');
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });
            logEl.innerHTML = `<div class="log-entry"><span class="log-time">${time}</span><span class="log-type ${type}">${type.toUpperCase()}</span><span>${msg}</span></div>` + logEl.innerHTML;
        }

        async function runFusion() {
            log('Starting multi-modal fusion...', 'info');
            document.getElementById('fusion-results').innerHTML = '<p style="color:var(--gold);">Processing...</p>';
            await new Promise(r => setTimeout(r, 2000));
            const prob = Math.floor(Math.random() * 15 + 82);
            document.getElementById('fusion-results').innerHTML = `<div style="font-size:2.5rem;font-weight:800;color:var(--gold);">${prob}%</div><div style="color:var(--muted);">Fusion Confidence</div>`;
            document.getElementById('stat-fusion').textContent = prob + '%';
            log(`Fusion complete: ${prob}% confidence`, 'success');
        }

        async function runAI() {
            log('Running AI prediction...', 'info');
            const lat = parseFloat(document.getElementById('ai-lat').value);
            const lon = parseFloat(document.getElementById('ai-lon').value);
            if (window.archaeologicalAI) {
                const sensorData = archaeologicalAI.generateSyntheticSensorData([lat, lon]);
                const prediction = archaeologicalAI.predict([lat, lon], sensorData);
                document.getElementById('ai-results').innerHTML = `<div style="font-size:2rem;font-weight:700;color:var(--gold);">${Math.round(prediction.probability * 100)}%</div><div>Type: ${prediction.predictedType}</div><div style="color:var(--muted);margin-top:0.5rem;">Priority: ${prediction.recommendation.priority}</div>`;
                log(`AI prediction: ${Math.round(prediction.probability * 100)}% (${prediction.predictedType})`, 'success');
            }
        }

        async function createProof() {
            if (window.blockchainProof) {
                const proof = await blockchainProof.createProof({ type: 'discovery', coordinates: [29.9792, 31.1342], probability: 0.87 });
                document.getElementById('proof-chain').innerHTML += `<div style="background:var(--bg);padding:1rem;border-radius:8px;margin-bottom:0.5rem;"><div style="color:var(--gold);font-weight:500;">${proof.id}</div><div style="font-size:0.7rem;color:var(--muted);">${proof.timestamp}</div><div style="font-family:monospace;font-size:0.65rem;color:var(--green);word-break:break-all;margin-top:0.5rem;">${proof.hash}</div></div>`;
                document.getElementById('stat-proofs').textContent = blockchainProof.getChain().length;
                log(`Proof created: ${proof.id}`, 'success');
            }
        }

        async function archiveToIPFS() {
            if (window.ipfsArchive) {
                const archive = await ipfsArchive.pinToIPFS({ project: 'SHAM', timestamp: new Date().toISOString() }, 'Test Archive');
                document.getElementById('ipfs-archives').innerHTML += `<div style="background:var(--bg);padding:1rem;border-radius:8px;margin-bottom:0.5rem;"><div style="color:var(--gold);">${archive.name}</div><div style="font-family:monospace;font-size:0.7rem;color:var(--cyan);margin-top:0.5rem;">${archive.cid}</div></div>`;
                log(`Archived to IPFS: ${archive.cid.substring(0, 20)}...`, 'success');
            }
        }

        async function submitForReview() {
            if (window.crowdsourcedVerification) {
                const submission = crowdsourcedVerification.submitForReview({ id: 'ANOM-001', coordinates: [29.9792, 31.1342], probability: 0.87 });
                crowdsourcedVerification.simulateCommunity(submission.id, 15);
                const report = crowdsourcedVerification.generateReport(submission.id);
                document.getElementById('review-status').innerHTML = `<div style="background:var(--bg);padding:1rem;border-radius:8px;"><div style="color:var(--gold);font-weight:500;">${submission.id}</div><div style="margin-top:0.5rem;">Status: <span style="color:var(--green);">${report.status.toUpperCase()}</span></div><div>Score: ${report.verificationScore}</div><div style="color:var(--muted);font-size:0.85rem;margin-top:0.5rem;">${report.totalVotes} votes received</div></div>`;
                log(`Submitted for review: ${submission.id}`, 'success');
            }
        }

        async function generatePaper() {
            if (window.autoPaperGenerator) {
                const paper = autoPaperGenerator.generatePaper({ location: 'Giza Plateau', probability: 0.94, anomalyCount: 4 });
                const md = autoPaperGenerator.exportToMarkdown(paper);
                document.getElementById('paper-preview').innerHTML = `<pre style="white-space:pre-wrap;font-size:0.75rem;color:var(--text);">${md.substring(0, 3000)}...</pre>`;
                log(`Paper generated: ${paper.content.title.substring(0, 50)}...`, 'success');
            }
        }

        async function createMediaKit() {
            if (window.mediaKitCreator) {
                const kit = mediaKitCreator.createMediaKit({ location: 'Giza Plateau', probability: 0.94, anomalyCount: 4 });
                document.getElementById('media-kit').innerHTML = `<div style="background:var(--bg);padding:1rem;border-radius:8px;"><h4 style="color:var(--gold);margin-bottom:1rem;">Media Kit Created</h4><p>✅ Press Release</p><p>✅ Social Media (Twitter, Instagram, LinkedIn)</p><p>✅ Fact Sheet</p><p>✅ FAQ</p><p>✅ Email Templates</p><button class="btn btn-outline btn-sm" style="margin-top:1rem;" onclick="alert(JSON.stringify(mediaKitCreator.getKits()[0].assets.socialMedia.twitter,null,2))">View Twitter Thread</button></div>`;
                log('Media kit created with all assets', 'success');
            }
        }

        function startGPS() {
            if (window.mobileFieldApp) {
                mobileFieldApp.startTracking();
                document.getElementById('gps-status').innerHTML = `<div style="background:var(--bg);padding:1rem;border-radius:8px;color:var(--green);"><i class="fas fa-location-arrow"></i> GPS Tracking Active</div>`;
                log('GPS tracking started', 'success');
            }
        }

        function generateFlightPlan() {
            if (window.droneSurvey) {
                const plan = droneSurvey.createFlightPlan([{ id: 'ANOM-001', coordinates: [29.9792, 31.1342] }]);
                document.getElementById('flight-plan').innerHTML = `<div style="background:var(--bg);padding:1rem;border-radius:8px;"><h4 style="color:var(--gold);">Flight Plan: ${plan.id}</h4><p>${plan.waypoints.length} waypoints</p><p>Est. time: ${Math.round(plan.coverage.estimatedFlightTime / 60)} min</p><button class="btn btn-outline btn-sm" style="margin-top:0.5rem;" onclick="alert(droneSurvey.exportFlightPlan('${plan.id}','csv'))">Export CSV</button></div>`;
                log(`Flight plan generated: ${plan.waypoints.length} waypoints`, 'success');
            }
        }

        function processGPR() {
            if (window.gprProcessor) {
                gprProcessor.processProfile({}, { fileName: 'survey_001.rd3', antenna: '400 MHz' }).then(profile => {
                    document.getElementById('gpr-results').innerHTML = `<div style="background:var(--bg);padding:1rem;border-radius:8px;"><h4 style="color:var(--gold);">GPR Analysis Complete</h4><p>${profile.results.anomalies.length} anomalies detected</p><p>Max depth: ${profile.results.summary.maxDepthReached}m</p></div>`;
                    log(`GPR processed: ${profile.results.anomalies.length} anomalies`, 'success');
                });
            }
        }

        function runFullAnalysis() { runFusion(); }
        function exportAll() { log('Exporting all data...', 'info'); }
    </script>
</body>

</html>